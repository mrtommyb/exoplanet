<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
<title>Astrometric fitting &mdash; exoplanet 0.3.0 documentation</title>
  

<link rel="shortcut icon" href="../../_static/logo.png"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono"><link rel="stylesheet" href="../../_static/typlog.css?v=0.7.3" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme.css?v=0.7.3" type="text/css" /><link rel="stylesheet" href="../../_static/css/exoplanet.css?v=2020-01-15" type="text/css" />
      <link rel="index" title="Index" href="../../genindex/"/>
      <link rel="search" title="Search" href="../../search/"/>
    <link rel="top" title="exoplanet 0.3.0 documentation" href="../../"/>
      <link rel="next" title="Scalable Gaussian processes in PyMC3" href="../gp/"/>
      <link rel="prev" title="Transit fitting" href="../transit/"/>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', '');ga('send', 'pageview');</script>
  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <meta property="og:type" content="website">
  <meta property="og:site_name" content="exoplanet">
  <meta property="og:title" content="Astrometric fitting">
  <meta name="twitter:card" content="summary">
<script src="https://kit.fontawesome.com/12d959964a.js" crossorigin="anonymous"></script>
<script src="https://unpkg.com/mustache@latest"></script>
<script>
    $.ajax({
        dataType: "json",
        url: "https://raw.githubusercontent.com/exoplanet-dev/exoplanet/gh-pages/versions.json",
        success: function (data) {
            var versions = Object.keys(data).sort();
            $(function render() {
                var template = document.getElementById('versions-template').innerHTML;
                var rendered = Mustache.render(template, { versions: versions });
                document.body.innerHTML += rendered;
                $(".current-version").click(function () {
                    $(".versions-dropdown").toggle();
                });
            });
        }
    });
</script>

</head>
<body role="document" data-page="tutorials/astrometric">
  <header class="t-head">
    <div class="t-head_menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64 384h384v-42.666H64V384zm0-106.666h384v-42.667H64v42.667zM64 128v42.665h384V128H64z"/></svg></div>
    <a class="t-head_logo" href="../../"><img src="../../_static/logo.png" alt="Logo"/>exoplanet
    </a>
  </header>
  <aside class="t-sidebar">
    <div class="t-sidebar_close">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z"/></svg>
    </div>
    <div class="inner">
<a class="logo" href="../../"><img src="../../_static/logo.png" alt="Logo"/>
    exoplanet
</a><div class="globaltoc">
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/install/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation/">Citing exoplanet &amp; its dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/api/">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/dev/">Developer documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro-to-pymc3/">A quick intro to PyMC3 for exoplaneteers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pymc3-extras/">PyMC3 extras</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rv/">Radial velocity fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transit/">Transit fitting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Astrometric fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data">Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#astrometric-conventions">Astrometric conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting-the-astrometric-orbit-with-exoplanet">Fitting the astrometric orbit with <em>exoplanet</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="#including-parallax">Including parallax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#citations">Citations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gp/">Scalable Gaussian processes in PyMC3</a></li>
</ul>

</div><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../">Documentation overview</a><ul>
      <li>Previous: <a href="../transit/" title="previous chapter">Transit fitting</a></li>
      <li>Next: <a href="../gp/" title="next chapter">Scalable Gaussian processes in PyMC3</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox">
  <form class="search" action="../../search/" method="get">
    <div class="input-group">
      <input type="text" name="q" placeholder="Search" />
      <button type="submit">Go</button>
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    </div>
  </aside>
  <div class="t-content">
    <div class="t-body yue">
      


  <span class="target" id="module-exoplanet"></span><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial was generated from an IPython notebook that can be
downloaded <a class="reference external" href="../../_static/notebooks/astrometric.ipynb">here</a>.</p>
</div>
<div class="section" id="astrometric-fitting">
<span id="astrometric"></span><h1>Astrometric fitting<a class="headerlink" href="#astrometric-fitting" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we’ll walk through the simplest astrometric example
with <code class="docutils literal notranslate"><span class="pre">exoplanet</span></code> and then explain how to build up a more complicated
example with parallax measurements. For our dataset, we’ll use
astrometric and radial velocity observations of a binary star system.</p>
<p>Astrometric observations usually consist of measurements of the
separation and position angle of the secondary star (or directly imaged
exoplanet), relative to the primary star as a function of time. The
simplest astrometric orbit (in terms of number of parameters), describes
the orbit using a semi-major axis <code class="docutils literal notranslate"><span class="pre">a_ang</span></code> measured in <em>arcseconds</em>,
since the distance to the system is assumed to be unknown. We’ll work
through this example first, then introduce the extra constraints
provided by parallax information.</p>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<p>First, let’s load and examine the data. We’ll use the astrometric
measurements of HR 466 (HD 10009) as compiled by <a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/1998A&amp;AS..131..377P/abstract">Pourbaix
1998</a>.
The speckle observations are originally from <a class="reference external" href="https://ui.adsabs.harvard.edu/#abs/1996AJ....111..370H/abstract">Hartkopf et
al. 1996</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>

<span class="c1"># grab the formatted data and do some munging</span>
<span class="n">dirname</span> <span class="o">=</span> <span class="s2">&quot;https://gist.github.com/iancze/262aba2429cb9aee3fd5b5e1a4582d4d/raw/c5fa5bc39fec90d2cc2e736eed479099e3e598e3/&quot;</span>

<span class="n">astro_data_full</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="n">dirname</span> <span class="o">+</span> <span class="s2">&quot;astro.txt&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">fill_values</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)]</span>
<span class="p">)</span>

<span class="c1"># convert UT date to JD</span>
<span class="n">astro_dates</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">astro_data_full</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;decimalyear&quot;</span><span class="p">)</span>

<span class="c1"># Following the Pourbaix et al. 1998 analysis, we&#39;ll limit ourselves to the highest quality data</span>
<span class="c1"># since the raw collection of data outside of these ranges has some ambiguities in swapping</span>
<span class="c1"># the primary and secondary star</span>
<span class="n">ind</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">astro_dates</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mf">1975.0</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">astro_dates</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mf">1999.73</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">astro_data_full</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">astro_data_full</span><span class="p">[</span><span class="s2">&quot;PA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">astro_data</span> <span class="o">=</span> <span class="n">astro_data_full</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

<span class="n">astro_yrs</span> <span class="o">=</span> <span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
<span class="n">astro_dates</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;jd&quot;</span>
<span class="n">astro_jds</span> <span class="o">=</span> <span class="n">astro_dates</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>Many of these measurements in this heterogeneous dataset do not have
reported error measurements. For these, we assume a modest uncertainty
of <span class="math notranslate nohighlight">\(1^\circ\)</span> in position angle and <span class="math notranslate nohighlight">\(0.01^{\prime\prime}\)</span> in
separation for the sake of specifying something, but we’ll include a
jitter term for both of these measurements as well. The scatter in
points around the final solution will be a decent guide of what the
measurement uncertainties actually were.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;rho_err&quot;</span><span class="p">][</span><span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;rho_err&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;PA_err&quot;</span><span class="p">][</span><span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;PA_err&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># Convert all masked frames to be raw np arrays, since theano has issues with astropy masked columns</span>
<span class="n">rho_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>  <span class="c1"># arcsec</span>
<span class="n">rho_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;rho_err&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># The position angle measurements come in degrees in the range [0, 360].</span>
<span class="c1"># We&#39;ll convert this to radians in the range [-pi, pi]</span>
<span class="n">deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
<span class="n">theta_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;PA&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">deg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">theta_data</span><span class="p">[</span><span class="n">theta_data</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="n">theta_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">astro_data</span><span class="p">[</span><span class="s2">&quot;PA_err&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span>  <span class="c1"># radians</span>
</pre></div>
</div>
</div>
<div class="section" id="astrometric-conventions">
<h2>Astrometric conventions<a class="headerlink" href="#astrometric-conventions" title="Permalink to this headline">¶</a></h2>
<p>The conventions describing the orientation of the orbits are described
in detail in the <em>exoplanet</em> paper; we summarize them briefly here.
Generally, we follow the conventions from Pourbaix et al. 1998, which
are a consistent set conforming to the right-hand-rule and the
conventions of the visual binary field, where the ascending node is that
where the secondary is <em>receeding</em> from the observer (without radial
velocity information, there is a <span class="math notranslate nohighlight">\(\pi\)</span> degeneracy in which node is
ascending, and so common practice in the literature is to report a value
in the range <span class="math notranslate nohighlight">\([0,\pi]\)</span>). The orbital inclination ranges from
<span class="math notranslate nohighlight">\([0, \pi\)</span>]. <span class="math notranslate nohighlight">\(i = 0\)</span> describes a face-on orbit rotating
counter-clockwise on the sky plane, while <span class="math notranslate nohighlight">\(i=\pi\)</span> describes a
face-on orbit rotating clockwise on the sky. <span class="math notranslate nohighlight">\(i = \pi/2\)</span> is an
edge-on orbit.</p>
<p>The observer frame <span class="math notranslate nohighlight">\(X\)</span>, <span class="math notranslate nohighlight">\(Y\)</span>, <span class="math notranslate nohighlight">\(Z\)</span> is oriented on the
sky such that <span class="math notranslate nohighlight">\(+Z\)</span> points towards the observer, <span class="math notranslate nohighlight">\(X\)</span> is the
north axis, and <span class="math notranslate nohighlight">\(Y\)</span> is the east axis. <em>All</em> angles are measured in
radians, and the position angle is returned in the range
<span class="math notranslate nohighlight">\([-\pi, \pi]\)</span>, which is the degrees east of north (be sure to
check your data is in this format too!) The radial velocity is still
defined such that a positive radial velocity corresponds to motion away
from the observer.</p>
<p>In an astrometric-only orbit, it is common practice in the field to
report <span class="math notranslate nohighlight">\(\omega = \omega_\mathrm{secondary}\)</span>, whereas with an RV
orbit it is generally common practice to report
<span class="math notranslate nohighlight">\(\omega = \omega_\mathrm{primary}\)</span>. The result is that unless the
authors specify what they’re using, in a joint astrometric-RV orbit
there is an ambiguity to which <span class="math notranslate nohighlight">\(\omega\)</span> the authors mean, since
<span class="math notranslate nohighlight">\(\omega_\mathrm{primary} = \omega_\mathrm{secondary} + \pi\)</span>. To
standardize this across the <em>exoplanet</em> package, in all orbits
(including astrometric-only) <span class="math notranslate nohighlight">\(\omega = \omega_\mathrm{primary}\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Make a plot of the astrometric data on the sky</span>
<span class="c1"># The convention is that North is up and East is left</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">rho_data</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_data</span><span class="p">)</span>  <span class="c1"># X is north</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">rho_data</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_data</span><span class="p">)</span>  <span class="c1"># Y is east</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;.k&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta \delta$ [&#39;&#39;]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta \alpha \cos \delta$ [&#39;&#39;]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;k*&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;datalim&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/astrometric_8_0.png" src="../../_images/astrometric_8_0.png" />
<p>The plot on the sky is helpful to look at, but the “raw” measurements
are the values of <span class="math notranslate nohighlight">\(\rho\)</span> (separation) and <span class="math notranslate nohighlight">\(\theta\)</span> (also
called P.A., position angle) that we listed in our data table, and that
the measurement uncertainties live on these values as nice Gaussians.
So, to visualize this space more clearly, we can plot <span class="math notranslate nohighlight">\(\rho\)</span>
vs. time and P.A. vs. time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_yrs</span><span class="p">,</span> <span class="n">rho_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">rho_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho\,$ [&quot;]&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_yrs</span><span class="p">,</span> <span class="n">theta_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">theta_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;P.A. [radians]&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time [years]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/astrometric_10_0.png" src="../../_images/astrometric_10_0.png" />
</div>
<div class="section" id="fitting-the-astrometric-orbit-with-exoplanet">
<h2>Fitting the astrometric orbit with <em>exoplanet</em><a class="headerlink" href="#fitting-the-astrometric-orbit-with-exoplanet" title="Permalink to this headline">¶</a></h2>
<p>To get started, let’s import the relative packages from <em>exoplanet</em>,
plot up a preliminary orbit from the literature, and then sample to find
the best parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Orbits in <em>exoplanet</em> generally specify the semi-major axis in units of solar radii <cite>R_sun</cite>. For transits and RV orbits, you usually have enough external information (e.g., estimate of stellar mass from spectral type) to put a physical scale onto the orbit. For the most basic of astrometric orbits without parallax information, however, this information can be lacking and thus it makes sense to fit for the semi-major axis in units of <cite>arcseconds</cite>. But, <cite>exoplanet</cite> is modeling a real orbit (where semi-major axis is in units of <cite>R_sun</cite>), so we do need to at least provide a fake parallax to convert from arcseconds to <cite>R_sun.</cite></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">theano</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>

<span class="kn">import</span> <span class="nn">exoplanet</span> <span class="k">as</span> <span class="nn">xo</span>
<span class="kn">from</span> <span class="nn">exoplanet.distributions</span> <span class="kn">import</span> <span class="n">Angle</span>

<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">constants</span>

<span class="c1"># conversion constant from au to R_sun</span>
<span class="n">au_to_R_sun</span> <span class="o">=</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">au</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">R_sun</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># Just to get started, let&#39;s take a look at the orbit using the best-fit parameters from Pourbaix et al. 1998</span>

<span class="c1"># Orbital elements from Pourbaix et al. 1998</span>
<span class="c1"># For the relative astrometric fit, we only need the following parameters</span>
<span class="n">a_ang</span> <span class="o">=</span> <span class="mf">0.324</span>  <span class="c1"># arcsec</span>
<span class="n">parallax</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># arcsec (meaningless choice for now)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">a_ang</span> <span class="o">*</span> <span class="n">au_to_R_sun</span> <span class="o">/</span> <span class="n">parallax</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.798</span>
<span class="n">i</span> <span class="o">=</span> <span class="mf">96.0</span> <span class="o">*</span> <span class="n">deg</span>  <span class="c1"># [rad]</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">251.6</span> <span class="o">*</span> <span class="n">deg</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># Pourbaix reports omega_2, but we want omega_1</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="mf">159.6</span> <span class="o">*</span> <span class="n">deg</span>
<span class="n">P</span> <span class="o">=</span> <span class="mf">28.8</span> <span class="o">*</span> <span class="mf">365.25</span>  <span class="c1"># days</span>

<span class="n">T0</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mf">1989.92</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;decimalyear&quot;</span><span class="p">)</span>
<span class="n">T0</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;jd&quot;</span>
<span class="n">T0</span> <span class="o">=</span> <span class="n">T0</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># [Julian Date]</span>

<span class="c1"># instantiate the orbit</span>
<span class="n">orbit</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">orbits</span><span class="o">.</span><span class="n">KeplerianOrbit</span><span class="p">(</span>
    <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">t_periastron</span><span class="o">=</span><span class="n">T0</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">incl</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">ecc</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">Omega</span><span class="o">=</span><span class="n">Omega</span>
<span class="p">)</span>

<span class="c1"># The position functions take an optional argument parallax to convert from</span>
<span class="c1"># physical units back to arcseconds</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T0</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">P</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>  <span class="c1"># days</span>
<span class="n">rho</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">theano</span><span class="o">.</span><span class="n">function</span><span class="p">([],</span> <span class="n">orbit</span><span class="o">.</span><span class="n">get_relative_angles</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">parallax</span><span class="p">))()</span>

<span class="c1"># Plot the orbit</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>  <span class="c1"># X is north</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>  <span class="c1"># Y is east</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot the data</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">rho_data</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_data</span><span class="p">)</span>  <span class="c1"># X is north</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">rho_data</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_data</span><span class="p">)</span>  <span class="c1"># Y is east</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;.k&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta \delta$ [&#39;&#39;]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta \alpha \cos \delta$ [&#39;&#39;]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;k*&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;datalim&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;initial orbit&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_jds</span><span class="p">,</span> <span class="n">rho_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">rho_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho\,$ [&quot;]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;initial orbit&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_jds</span><span class="p">,</span> <span class="n">theta_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">theta_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;P.A. [radians]&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time [JD]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/astrometric_13_0.png" src="../../_images/astrometric_13_0.png" />
<img alt="../../_images/astrometric_13_1.png" src="../../_images/astrometric_13_1.png" />
<p>Now that we have an initial orbit, we can set the model up using PyMC3
to do inference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yr</span> <span class="o">=</span> <span class="mf">365.25</span>

<span class="c1"># for predicted orbits</span>
<span class="n">t_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">astro_jds</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">500</span><span class="p">,</span> <span class="n">astro_jds</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">500</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">parallax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Without an actual parallax measurement, we can model the orbit in units of arcseconds</span>
            <span class="c1"># by providing a fake_parallax and conversion constant</span>
            <span class="n">plx</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># arcsec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Below we will run a version of this model where a measurement of parallax is provided</span>
            <span class="c1"># The measurement is in milliarcsec</span>
            <span class="n">m_plx</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">100</span><span class="p">)(</span>
                <span class="s2">&quot;m_plx&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">parallax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sd</span><span class="o">=</span><span class="n">parallax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">testval</span><span class="o">=</span><span class="n">parallax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">plx</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;plx&quot;</span><span class="p">,</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="n">m_plx</span><span class="p">)</span>

        <span class="n">a_ang</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;a_ang&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.324</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">a_ang</span> <span class="o">/</span> <span class="n">plx</span><span class="p">)</span>

        <span class="c1"># We expect the period to be somewhere in the range of 25 years,</span>
        <span class="c1"># so we&#39;ll set a broad prior on logP</span>
        <span class="n">logP</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span>
            <span class="s2">&quot;logP&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">25</span> <span class="o">*</span> <span class="n">yr</span><span class="p">),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">28.8</span> <span class="o">*</span> <span class="n">yr</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logP</span><span class="p">))</span>

        <span class="c1"># For astrometric-only fits, it&#39;s generally better to fit in</span>
        <span class="c1"># p = (Omega + omega)/2 and m = (Omega - omega)/2 instead of omega and Omega</span>
        <span class="c1"># directly</span>
        <span class="n">omega0</span> <span class="o">=</span> <span class="mf">251.6</span> <span class="o">*</span> <span class="n">deg</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">Omega0</span> <span class="o">=</span> <span class="mf">159.6</span> <span class="o">*</span> <span class="n">deg</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Omega0</span> <span class="o">+</span> <span class="n">omega0</span><span class="p">))</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Omega0</span> <span class="o">-</span> <span class="n">omega0</span><span class="p">))</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span>
        <span class="n">Omega</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;Omega&quot;</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>

        <span class="c1"># For these orbits, it can also be better to fit for a phase angle</span>
        <span class="c1"># (relative to a reference time) instead of the time of periasteron</span>
        <span class="c1"># passage directly</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="s2">&quot;phase&quot;</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">tperi</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;tperi&quot;</span><span class="p">,</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">P</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="c1"># Geometric uiform prior on cos(incl)</span>
        <span class="n">cos_incl</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span>
            <span class="s2">&quot;cos_incl&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">96.0</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">incl</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;incl&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cos_incl</span><span class="p">))</span>
        <span class="n">ecc</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;ecc&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">testval</span><span class="o">=</span><span class="mf">0.798</span><span class="p">)</span>

        <span class="c1"># Set up the orbit</span>
        <span class="n">orbit</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">orbits</span><span class="o">.</span><span class="n">KeplerianOrbit</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="n">a</span> <span class="o">*</span> <span class="n">au_to_R_sun</span><span class="p">,</span>
            <span class="n">t_periastron</span><span class="o">=</span><span class="n">tperi</span><span class="p">,</span>
            <span class="n">period</span><span class="o">=</span><span class="n">P</span><span class="p">,</span>
            <span class="n">incl</span><span class="o">=</span><span class="n">incl</span><span class="p">,</span>
            <span class="n">ecc</span><span class="o">=</span><span class="n">ecc</span><span class="p">,</span>
            <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
            <span class="n">Omega</span><span class="o">=</span><span class="n">Omega</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">parallax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;M_tot&quot;</span><span class="p">,</span> <span class="n">orbit</span><span class="o">.</span><span class="n">m_total</span><span class="p">)</span>

        <span class="c1"># Compute the model in rho and theta</span>
        <span class="n">rho_model</span><span class="p">,</span> <span class="n">theta_model</span> <span class="o">=</span> <span class="n">orbit</span><span class="o">.</span><span class="n">get_relative_angles</span><span class="p">(</span><span class="n">astro_jds</span><span class="p">,</span> <span class="n">plx</span><span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;rho_model&quot;</span><span class="p">,</span> <span class="n">rho_model</span><span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;theta_model&quot;</span><span class="p">,</span> <span class="n">theta_model</span><span class="p">)</span>

        <span class="c1"># Add jitter terms to both separation and position angle</span>
        <span class="n">log_rho_s</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span>
            <span class="s2">&quot;log_rho_s&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rho_err</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">5.0</span>
        <span class="p">)</span>
        <span class="n">log_theta_s</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span>
            <span class="s2">&quot;log_theta_s&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">theta_err</span><span class="p">)),</span> <span class="n">sd</span><span class="o">=</span><span class="mf">5.0</span>
        <span class="p">)</span>
        <span class="n">rho_tot_err</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rho_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">log_rho_s</span><span class="p">))</span>
        <span class="n">theta_tot_err</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">theta_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">log_theta_s</span><span class="p">))</span>

        <span class="c1"># define the likelihood function, e.g., a Gaussian on both rho and theta</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;rho_obs&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">rho_model</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">rho_tot_err</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">rho_data</span><span class="p">)</span>

        <span class="c1"># We want to be cognizant of the fact that theta wraps so the following is equivalent to</span>
        <span class="c1"># pm.Normal(&quot;obs_theta&quot;, mu=theta_model, observed=theta_data, sd=theta_tot_err)</span>
        <span class="c1"># but takes into account the wrapping. Thanks to Rob de Rosa for the tip.</span>
        <span class="n">theta_diff</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_model</span> <span class="o">-</span> <span class="n">theta_data</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_model</span> <span class="o">-</span> <span class="n">theta_data</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;theta_obs&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">theta_diff</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">theta_tot_err</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># Set up predicted orbits for later plotting</span>
        <span class="n">rho_dense</span><span class="p">,</span> <span class="n">theta_dense</span> <span class="o">=</span> <span class="n">orbit</span><span class="o">.</span><span class="n">get_relative_angles</span><span class="p">(</span><span class="n">t_fine</span><span class="p">,</span> <span class="n">plx</span><span class="p">)</span>
        <span class="n">rho_save</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;rho_save&quot;</span><span class="p">,</span> <span class="n">rho_dense</span><span class="p">)</span>
        <span class="n">theta_save</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;theta_save&quot;</span><span class="p">,</span> <span class="n">theta_dense</span><span class="p">)</span>

        <span class="c1"># Optimize to find the initial parameters</span>
        <span class="n">map_soln</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test_point</span>
        <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">map_soln</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">log_rho_s</span><span class="p">,</span> <span class="n">log_theta_s</span><span class="p">])</span>
        <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">map_soln</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">phase</span><span class="p">])</span>
        <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">map_soln</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">ecc</span><span class="p">])</span>
        <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">map_soln</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="n">logP</span><span class="p">,</span> <span class="n">a_ang</span><span class="p">,</span> <span class="n">phase</span><span class="p">])</span>
        <span class="n">map_soln</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">map_soln</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">map_soln</span>


<span class="n">model</span><span class="p">,</span> <span class="n">map_soln</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">log_theta_s</span><span class="p">,</span> <span class="n">log_rho_s</span><span class="p">]</span>
<span class="mi">11</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">,</span>  <span class="mf">2.34</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">1.471440e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">104.85554109304441</span> <span class="o">-&gt;</span> <span class="mf">147.14399186005338</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">phase</span><span class="p">]</span>
<span class="mi">23</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span> <span class="mf">22.94</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">1.676422e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">147.14399186005338</span> <span class="o">-&gt;</span> <span class="mf">167.64220598197195</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">ecc</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span>
<span class="mi">35</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">35.56</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">2.100634e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">167.64220598197198</span> <span class="o">-&gt;</span> <span class="mf">210.06340668297898</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">phase</span><span class="p">,</span> <span class="n">a_ang</span><span class="p">,</span> <span class="n">logP</span><span class="p">]</span>
<span class="mi">12</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">8.74</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">2.105014e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">210.06340668297898</span> <span class="o">-&gt;</span> <span class="mf">210.5013698914948</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">log_theta_s</span><span class="p">,</span> <span class="n">log_rho_s</span><span class="p">,</span> <span class="n">ecc</span><span class="p">,</span> <span class="n">cos_incl</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">logP</span><span class="p">,</span> <span class="n">a_ang</span><span class="p">]</span>
<span class="mi">36</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">36.27</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">2.150212e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">210.50136989149482</span> <span class="o">-&gt;</span> <span class="mf">215.021177422118</span>
</pre></div>
</div>
<p>Now that we have a maximum a posteriori estimate of the parameters,
let’s take a look at the results to make sure that they seem reasonable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho\,$ [&quot;]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\rho$ residuals&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;P.A. [radians]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;P.A. residuals&quot;</span><span class="p">)</span>

<span class="n">tot_rho_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rho_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">map_soln</span><span class="p">[</span><span class="s2">&quot;log_rho_s&quot;</span><span class="p">]))</span>
<span class="n">tot_theta_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">theta_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">map_soln</span><span class="p">[</span><span class="s2">&quot;log_theta_s&quot;</span><span class="p">]))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_jds</span><span class="p">,</span> <span class="n">rho_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">tot_rho_err</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_fine</span><span class="p">,</span> <span class="n">map_soln</span><span class="p">[</span><span class="s2">&quot;rho_save&quot;</span><span class="p">],</span> <span class="s2">&quot;C1&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">astro_jds</span><span class="p">,</span> <span class="n">rho_data</span> <span class="o">-</span> <span class="n">map_soln</span><span class="p">[</span><span class="s2">&quot;rho_model&quot;</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">tot_rho_err</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span>
<span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_fine</span><span class="p">,</span> <span class="n">map_soln</span><span class="p">[</span><span class="s2">&quot;theta_save&quot;</span><span class="p">],</span> <span class="s2">&quot;C1&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_jds</span><span class="p">,</span> <span class="n">theta_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">tot_theta_err</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">astro_jds</span><span class="p">,</span> <span class="n">theta_data</span> <span class="o">-</span> <span class="n">map_soln</span><span class="p">[</span><span class="s2">&quot;theta_model&quot;</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">tot_theta_err</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span>
<span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">t_fine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_fine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;map orbit&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/astrometric_17_0.png" src="../../_images/astrometric_17_0.png" />
<p>Now let’s sample the posterior.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">tune</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">draws</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="n">map_soln</span><span class="p">,</span>
        <span class="n">cores</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="n">xo</span><span class="o">.</span><span class="n">get_dense_nuts_step</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">adaptation_window</span><span class="o">=</span><span class="mi">201</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Multiprocess sampling (2 chains in 2 jobs)
NUTS: [log_theta_s, log_rho_s, ecc, cos_incl, phase, m, p, logP, a_ang]
Sampling 2 chains, 0 divergences: 100%|██████████| 18000/18000 [02:36&lt;00:00, 114.83draws/s]
The number of effective samples is smaller than 25% for some parameters.
</pre></div>
</div>
<p>First we can check the convergence for some of the key parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span>
    <span class="n">trace</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;tperi&quot;</span><span class="p">,</span> <span class="s2">&quot;a_ang&quot;</span><span class="p">,</span> <span class="s2">&quot;omega&quot;</span><span class="p">,</span> <span class="s2">&quot;Omega&quot;</span><span class="p">,</span> <span class="s2">&quot;incl&quot;</span><span class="p">,</span> <span class="s2">&quot;ecc&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hpd_3%</th>
      <th>hpd_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>P</th>
      <td>10379.989</td>
      <td>120.269</td>
      <td>10189.566</td>
      <td>10630.311</td>
      <td>2.604</td>
      <td>1.848</td>
      <td>2133.0</td>
      <td>2118.0</td>
      <td>2591.0</td>
      <td>2460.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>tperi</th>
      <td>2447861.107</td>
      <td>19.609</td>
      <td>2447825.734</td>
      <td>2447899.241</td>
      <td>0.271</td>
      <td>0.192</td>
      <td>5218.0</td>
      <td>5218.0</td>
      <td>5225.0</td>
      <td>5049.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>a_ang</th>
      <td>0.317</td>
      <td>0.008</td>
      <td>0.304</td>
      <td>0.332</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>4887.0</td>
      <td>4878.0</td>
      <td>4914.0</td>
      <td>5094.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>omega</th>
      <td>1.235</td>
      <td>0.013</td>
      <td>1.209</td>
      <td>1.260</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>4559.0</td>
      <td>4559.0</td>
      <td>4582.0</td>
      <td>4345.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Omega</th>
      <td>2.787</td>
      <td>0.012</td>
      <td>2.764</td>
      <td>2.808</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>5881.0</td>
      <td>5881.0</td>
      <td>5897.0</td>
      <td>5811.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>incl</th>
      <td>1.692</td>
      <td>0.006</td>
      <td>1.681</td>
      <td>1.703</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>4764.0</td>
      <td>4764.0</td>
      <td>4761.0</td>
      <td>4324.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>ecc</th>
      <td>0.775</td>
      <td>0.012</td>
      <td>0.754</td>
      <td>0.797</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>4312.0</td>
      <td>4295.0</td>
      <td>4360.0</td>
      <td>4465.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div><p>That looks pretty good. Now here’s a corner plot showing the covariances
between parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>

<span class="n">samples</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">trace_to_dataframe</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">])</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$P$ [yr]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">yr</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$T_\mathrm</span><span class="si">{peri}</span><span class="s2"> - T_0$ [day]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s2">&quot;tperi&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$a$ [arcsec]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s2">&quot;a_ang&quot;</span><span class="p">]</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$\omega$ [deg]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s2">&quot;omega&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deg</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$\Omega$ [deg]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s2">&quot;Omega&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deg</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$i$ [deg]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s2">&quot;incl&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">deg</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$e$&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/astrometric_23_0.png" src="../../_images/astrometric_23_0.png" />
<p>Finally, we can plot the posterior constraints on <span class="math notranslate nohighlight">\(\rho\)</span> and
<span class="math notranslate nohighlight">\(\theta\)</span>. This figure is much like the one for the MAP solution
above, but this time the orange is a contour (not a line) showing the
68% credible region for the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho\,$ [&quot;]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;P.A. [radians]&quot;</span><span class="p">)</span>

<span class="n">tot_rho_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="n">rho_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s2">&quot;log_rho_s&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">tot_theta_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="n">theta_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s2">&quot;log_theta_s&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_jds</span><span class="p">,</span> <span class="n">rho_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">tot_rho_err</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s2">&quot;rho_save&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">84</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_fine</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">astro_jds</span><span class="p">,</span> <span class="n">theta_data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">tot_theta_err</span><span class="p">,</span> <span class="o">**</span><span class="n">ekw</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s2">&quot;theta_save&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">84</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_fine</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">t_fine</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_fine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;posterior inferences&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/astrometric_25_0.png" src="../../_images/astrometric_25_0.png" />
<p>As we can see from the narrow range of orbits (the orange swath appears
like a thin line), the orbit is actually highly constrained by the
astrometry. We also see two outlier epochs in the vicinity of 2445000 -
2447000, since adjacent epochs seem to be right on the orbit. It’s
likely the uncertainties were not estimated correctly for these, and the
simlplistic jitter model we implemented isn’t sophisticated to apply
more weight to only these discrepant points.</p>
</div>
<div class="section" id="including-parallax">
<h2>Including parallax<a class="headerlink" href="#including-parallax" title="Permalink to this headline">¶</a></h2>
<p>While this is encouraging that we fit an astrometric orbit, a simple
astrometric fit to just <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\theta\)</span> isn’t actually
that physically satisfying, since many of the orbital parameters simply
have to do with the orientation relative to us (<span class="math notranslate nohighlight">\(i\)</span>,
<span class="math notranslate nohighlight">\(\omega\)</span>, and <span class="math notranslate nohighlight">\(\Omega\)</span>). The only truely intrinsic
parameters are <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(e\)</span>. To learn more about some of the
physical parameters, such as the total mass of the system, we’d like to
incorporate distance information to put a physical scale to the problem.</p>
<p>The <em>Gaia</em> DR2 parallax is <span class="math notranslate nohighlight">\(\varpi = 24.05 \pm 0.45\)</span> mas.</p>
<p>We can use exactly the same model as above with only an added parallax
constraint:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plx_model</span><span class="p">,</span> <span class="n">plx_map_soln</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">parallax</span><span class="o">=</span><span class="p">[</span><span class="mf">24.05</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">log_theta_s</span><span class="p">,</span> <span class="n">log_rho_s</span><span class="p">]</span>
<span class="mi">11</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">5.87</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">1.499286e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">107.64015029566296</span> <span class="o">-&gt;</span> <span class="mf">149.92860106267193</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">phase</span><span class="p">]</span>
<span class="mi">23</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span> <span class="mf">21.79</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">1.704268e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">149.92860106267193</span> <span class="o">-&gt;</span> <span class="mf">170.4268151845905</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">ecc</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span>
<span class="mi">35</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span> <span class="mf">33.51</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">2.128480e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">170.42681518459054</span> <span class="o">-&gt;</span> <span class="mf">212.8480158855976</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">phase</span><span class="p">,</span> <span class="n">a_ang</span><span class="p">,</span> <span class="n">logP</span><span class="p">]</span>
<span class="mi">12</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span> <span class="mf">11.89</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">2.132860e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Optimization</span> <span class="n">terminated</span> <span class="n">successfully</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">212.8480158855976</span> <span class="o">-&gt;</span> <span class="mf">213.28597909410882</span>
<span class="n">optimizing</span> <span class="n">logp</span> <span class="k">for</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="n">log_theta_s</span><span class="p">,</span> <span class="n">log_rho_s</span><span class="p">,</span> <span class="n">ecc</span><span class="p">,</span> <span class="n">cos_incl</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">logP</span><span class="p">,</span> <span class="n">a_ang</span><span class="p">,</span> <span class="n">m_plx</span><span class="p">]</span>
<span class="mi">143</span><span class="n">it</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span> <span class="mf">114.85</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">logp</span><span class="o">=</span><span class="mf">2.178059e+02</span><span class="p">]</span>
<span class="n">message</span><span class="p">:</span> <span class="n">Desired</span> <span class="n">error</span> <span class="ow">not</span> <span class="n">necessarily</span> <span class="n">achieved</span> <span class="n">due</span> <span class="n">to</span> <span class="n">precision</span> <span class="n">loss</span><span class="o">.</span>
<span class="n">logp</span><span class="p">:</span> <span class="mf">213.28597909410882</span> <span class="o">-&gt;</span> <span class="mf">217.80586833503563</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">5432</span><span class="p">)</span>
<span class="k">with</span> <span class="n">plx_model</span><span class="p">:</span>
    <span class="n">plx_trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">tune</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">draws</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="n">plx_map_soln</span><span class="p">,</span>
        <span class="n">cores</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="n">xo</span><span class="o">.</span><span class="n">get_dense_nuts_step</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">plx_map_soln</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">Multiprocess sampling (2 chains in 2 jobs)
NUTS: [log_theta_s, log_rho_s, ecc, cos_incl, phase, m, p, logP, a_ang, m_plx]
Sampling 2 chains, 1 divergences: 100%|██████████| 18000/18000 [02:41&lt;00:00, 111.33draws/s]
There was 1 divergence after tuning. Increase <cite>target_accept</cite> or reparameterize.</pre>
<p>Check the convergence diagnostics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span>
    <span class="n">plx_trace</span><span class="p">,</span>
    <span class="n">varnames</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;P&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tperi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a_ang&quot;</span><span class="p">,</span>
        <span class="s2">&quot;omega&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Omega&quot;</span><span class="p">,</span>
        <span class="s2">&quot;incl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ecc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;M_tot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plx&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hpd_3%</th>
      <th>hpd_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>P</th>
      <td>10382.285</td>
      <td>123.962</td>
      <td>10176.411</td>
      <td>10625.795</td>
      <td>2.537</td>
      <td>1.802</td>
      <td>2388.0</td>
      <td>2366.0</td>
      <td>3085.0</td>
      <td>2099.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>tperi</th>
      <td>2447861.090</td>
      <td>19.732</td>
      <td>2447822.939</td>
      <td>2447895.955</td>
      <td>0.269</td>
      <td>0.190</td>
      <td>5372.0</td>
      <td>5372.0</td>
      <td>5385.0</td>
      <td>5127.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>a_ang</th>
      <td>0.317</td>
      <td>0.008</td>
      <td>0.303</td>
      <td>0.331</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>5097.0</td>
      <td>5065.0</td>
      <td>5261.0</td>
      <td>4697.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>omega</th>
      <td>1.235</td>
      <td>0.013</td>
      <td>1.211</td>
      <td>1.261</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>5202.0</td>
      <td>5198.0</td>
      <td>5218.0</td>
      <td>4820.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Omega</th>
      <td>2.787</td>
      <td>0.012</td>
      <td>2.766</td>
      <td>2.809</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>5619.0</td>
      <td>5616.0</td>
      <td>5649.0</td>
      <td>5297.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>incl</th>
      <td>1.692</td>
      <td>0.006</td>
      <td>1.680</td>
      <td>1.703</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>5023.0</td>
      <td>5023.0</td>
      <td>5043.0</td>
      <td>4383.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>ecc</th>
      <td>0.775</td>
      <td>0.012</td>
      <td>0.753</td>
      <td>0.798</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>4858.0</td>
      <td>4836.0</td>
      <td>4964.0</td>
      <td>4361.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>M_tot</th>
      <td>2.856</td>
      <td>0.268</td>
      <td>2.382</td>
      <td>3.370</td>
      <td>0.004</td>
      <td>0.003</td>
      <td>5557.0</td>
      <td>5491.0</td>
      <td>5609.0</td>
      <td>5394.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>plx</th>
      <td>0.024</td>
      <td>0.000</td>
      <td>0.023</td>
      <td>0.025</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>6839.0</td>
      <td>6839.0</td>
      <td>6832.0</td>
      <td>5382.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div><p>And make the corner plot for the physical parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">trace_to_dataframe</span><span class="p">(</span><span class="n">plx_trace</span><span class="p">,</span> <span class="n">varnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">])</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$P$ [yr]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plx_trace</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">yr</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$T_\mathrm</span><span class="si">{peri}</span><span class="s2"> - T_0$ [day]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plx_trace</span><span class="p">[</span><span class="s2">&quot;tperi&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$a$ [au]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plx_trace</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$M_\mathrm</span><span class="si">{tot}</span><span class="s2">$ [$M_\odot$]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plx_trace</span><span class="p">[</span><span class="s2">&quot;M_tot&quot;</span><span class="p">]</span>
<span class="n">samples</span><span class="p">[</span><span class="s2">&quot;$e$&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plx_trace</span><span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Substituting</span> <span class="k">with</span> <span class="n">a</span> <span class="n">symbol</span> <span class="kn">from</span> <span class="nn">Computer</span> <span class="n">Modern</span><span class="o">.</span>
<span class="n">Substituting</span> <span class="k">with</span> <span class="n">a</span> <span class="n">symbol</span> <span class="kn">from</span> <span class="nn">Computer</span> <span class="n">Modern</span><span class="o">.</span>
<span class="n">Substituting</span> <span class="k">with</span> <span class="n">a</span> <span class="n">symbol</span> <span class="kn">from</span> <span class="nn">Computer</span> <span class="n">Modern</span><span class="o">.</span>
<span class="n">Substituting</span> <span class="k">with</span> <span class="n">a</span> <span class="n">symbol</span> <span class="kn">from</span> <span class="nn">Computer</span> <span class="n">Modern</span><span class="o">.</span>
</pre></div>
</div>
<img alt="../../_images/astrometric_33_1.png" src="../../_images/astrometric_33_1.png" />
</div>
<div class="section" id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this headline">¶</a></h2>
<p>As described in the <a class="reference internal" href="../citation/#citation"><span class="std std-ref">Citing exoplanet &amp; its dependencies</span></a> tutorial, we can use
<a class="reference internal" href="../../user/api/#exoplanet.citations.get_citations_for_model" title="exoplanet.citations.get_citations_for_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">exoplanet.citations.get_citations_for_model()</span></code></a> to construct an
acknowledgement and BibTeX listing that includes the relevant citations
for this model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">txt</span><span class="p">,</span> <span class="n">bib</span> <span class="o">=</span> <span class="n">xo</span><span class="o">.</span><span class="n">citations</span><span class="o">.</span><span class="n">get_citations_for_model</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">This research made use of textsf{exoplanet} citep{exoplanet} and its
dependencies citep{exoplanet:astropy13, exoplanet:astropy18,
exoplanet:exoplanet, exoplanet:pymc3, exoplanet:theano}.</pre>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bib</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[:</span><span class="mi">10</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@misc</span><span class="p">{</span><span class="n">exoplanet</span><span class="p">:</span><span class="n">exoplanet</span><span class="p">,</span>
  <span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="n">Daniel</span> <span class="n">Foreman</span><span class="o">-</span><span class="n">Mackey</span> <span class="ow">and</span> <span class="n">Ian</span> <span class="n">Czekala</span> <span class="ow">and</span> <span class="n">Rodrigo</span> <span class="n">Luger</span> <span class="ow">and</span>
            <span class="n">Eric</span> <span class="n">Agol</span> <span class="ow">and</span> <span class="n">Geert</span> <span class="n">Barentsen</span> <span class="ow">and</span> <span class="n">Tom</span> <span class="n">Barclay</span><span class="p">},</span>
   <span class="n">title</span> <span class="o">=</span> <span class="p">{</span><span class="n">exoplanet</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">exoplanet</span> <span class="n">v0</span><span class="o">.</span><span class="mf">3.0</span><span class="p">},</span>
   <span class="n">month</span> <span class="o">=</span> <span class="n">apr</span><span class="p">,</span>
    <span class="n">year</span> <span class="o">=</span> <span class="mi">2020</span><span class="p">,</span>
     <span class="n">doi</span> <span class="o">=</span> <span class="p">{</span><span class="mf">10.5281</span><span class="o">/</span><span class="n">zenodo</span><span class="o">.</span><span class="mi">1998447</span><span class="p">},</span>
     <span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">doi</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mf">10.5281</span><span class="o">/</span><span class="n">zenodo</span><span class="o">.</span><span class="mi">1998447</span><span class="p">}</span>
<span class="p">}</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>

  <div class="t-pagination clearfix">
    <span>
      ← <a href="../transit/" title="Transit fitting">Transit fitting</a>
    </span>
    <span style="float:right">
      <a href="../gp/" title="Scalable Gaussian processes in PyMC3">Scalable Gaussian...</a> →
    </span>
  </div>


    </div>
<footer class="t-foot">
    &copy; Copyright 2018, 2019, 2020, Dan Foreman-Mackey.
    <br>
    A <a href="https://typlog.com/">typlog</a> <a href="https://github.com/typlog/sphinx-typlog-theme">sphinx theme</a>,
    designed by <a href="https://lepture.com/">Hsiaoming Yang</a>.
</footer>

<script id="versions-template" type="x-tmpl-mustache">
<div class="versions">
    <div class="current-version">
        v0.3.0
        <span class="fas fa-caret-down"></span>
    </div>
    <dl class="versions-dropdown">
        {{#versions}}
        <dd><a href="https://docs.exoplanet.codes/en/{{.}}/tutorials/astrometric">{{.}}</a></dd>
        {{/versions}}
    </dl>
</div>
</script>

  </div>
  <script>$(function(){$(".t-head_menu").on("click",function(){$("body").addClass("_expand")});$(".t-body").on("click",function(){$("body").removeClass("_expand")});$(".t-sidebar_close").on("click",function(){$("body").removeClass("_expand")});$("a.footnote-reference").on("click",function(e){e.preventDefault();var id=$(this).attr("href");var html=$(id).find("td.label + td").html();var w=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var style="top:"+e.pageY+"px;";if(w>560){style+="width:480px;";if(e.pageX>240&&e.pageX+240<w){style+="left:"+(e.pageX-240)+"px;"}else if(e.pageX<=240){style+="left:20px;"}else{style+="right:20px;"}}showFootnote(html,style)});function showFootnote(html,style){var CONTENT_ID="typlog-footnote-content";var content=document.getElementById(CONTENT_ID);if(!content){content=document.createElement("div");content.id=CONTENT_ID;$(".t-body").append(content)}var MASK_ID="typlog-footnote-mask";var mask=document.getElementById(MASK_ID);if(!mask){mask=document.createElement("div");mask.id=MASK_ID;document.body.appendChild(mask);mask.addEventListener("click",function(){content.className="";mask.className=""})}content.innerHTML=html;content.setAttribute("style",style);content.className="_active";mask.className="_active"}function fetchGitHubRepo(repo){var url="https://api.github.com/repos/"+repo;$.getJSON(url,function(data){var counts=[+new Date,data.stargazers_count,data.forks_count];localStorage.setItem("gh:"+repo,JSON.stringify(counts));updateGitHubStats(counts[1],counts[2])})}function updateGitHubStats(stars,forks){$(".github_stars strong").text(stars);$(".github_forks strong").text(forks)}function initGitHub(url){if(!url){return}var repo=url.replace("https://github.com/","");var cache=localStorage.getItem("gh:"+repo);if(cache){try{var counts=JSON.parse(cache);updateGitHubStats(counts[1],counts[2]);var delta=new Date-counts[0];if(delta<0||delta>9e5){fetchGitHubRepo(repo)}}catch(error){fetchGitHubRepo(repo)}}else{fetchGitHubRepo(repo)}}initGitHub($(".github").attr("href"))});</script>
</body>
</html>